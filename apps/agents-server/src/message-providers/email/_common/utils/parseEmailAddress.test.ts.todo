import { describe, expect, it } from '@jest/globals';
import { parseEmailAddress } from './parseEmailAddress';

describe('how parseEmailAddress works', () => {
    it('should work with simple email', () => {
        expect(parseEmailAddress('pavol@webgpt.cz')).toEqual({
            fullName: null,
            baseEmail: 'pavol@webgpt.cz',
            fullEmail: 'pavol@webgpt.cz',
            plus: [],
        });
        expect(parseEmailAddress('jirka@webgpt.cz')).toEqual({
            fullName: null,
            baseEmail: 'jirka@webgpt.cz',
            fullEmail: 'jirka@webgpt.cz',
            plus: [],
        });
        expect(parseEmailAddress('tomas@webgpt.cz')).toEqual({
            fullName: null,
            baseEmail: 'tomas@webgpt.cz',
            fullEmail: 'tomas@webgpt.cz',
            plus: [],
        });
    });

    it('should work with fullname', () => {
        expect(parseEmailAddress('Pavol Hejn칳 <pavol@webgpt.cz>')).toEqual({
            fullName: 'Pavol Hejn칳',
            baseEmail: 'pavol@webgpt.cz',
            fullEmail: 'pavol@webgpt.cz',
            plus: [],
        });
        expect(parseEmailAddress('Jirka <jirka@webgpt.cz>')).toEqual({
            fullName: 'Jirka',
            baseEmail: 'jirka@webgpt.cz',
            fullEmail: 'jirka@webgpt.cz',
            plus: [],
        });
        expect(parseEmailAddress('"Tom치코 Studen칤k" <tomas@webgpt.cz>')).toEqual({
            fullName: 'Tom치코 Studen칤k',
            baseEmail: 'tomas@webgpt.cz',
            fullEmail: 'tomas@webgpt.cz',
            plus: [],
        });
    });

    it('should work with plus', () => {
        expect(parseEmailAddress('pavol+test@webgpt.cz')).toEqual({
            fullName: null,
            baseEmail: 'pavol@webgpt.cz',
            fullEmail: 'pavol+test@webgpt.cz',
            plus: ['test'],
        });
        expect(parseEmailAddress('jirka+test@webgpt.cz')).toEqual({
            fullName: null,
            baseEmail: 'jirka@webgpt.cz',
            fullEmail: 'jirka+test@webgpt.cz',
            plus: ['test'],
        });
        expect(parseEmailAddress('tomas+test+ainautes@webgpt.cz')).toEqual({
            fullName: null,
            baseEmail: 'tomas@webgpt.cz',
            fullEmail: 'tomas+test+ainautes@webgpt.cz',
            plus: ['test', 'ainautes'],
        });
    });

    it('should work with both fullname and plus', () => {
        expect(parseEmailAddress('Pavol Hejn칳 <pavol+foo@webgpt.cz>')).toEqual({
            fullName: 'Pavol Hejn칳',
            baseEmail: 'pavol@webgpt.cz',
            fullEmail: 'pavol+foo@webgpt.cz',
            plus: ['foo'],
        });
        expect(parseEmailAddress('Jirka <jirka+test@webgpt.cz>')).toEqual({
            fullName: 'Jirka',
            baseEmail: 'jirka@webgpt.cz',
            fullEmail: 'jirka+test@webgpt.cz',
            plus: ['test'],
        });
        expect(parseEmailAddress('"Tom치코 Studen칤k" <tomas+test+ainautes@webgpt.cz>')).toEqual({
            fullName: 'Tom치코 Studen칤k',
            baseEmail: 'tomas@webgpt.cz',
            fullEmail: 'tomas+test+ainautes@webgpt.cz',
            plus: ['test', 'ainautes'],
        });
    });

    it('throws on multiple adresses', () => {
        expect(() => parseEmailAddress('Pavol <pavol@webgpt.cz>, Jirka <jirka@webgpt.cz>')).toThrowError(
            /Seems like you are trying to parse multiple email addresses/,
        );
    });

    it('throws on invalid email adresses', () => {
        expect(() => parseEmailAddress('')).toThrowError(/Invalid email address/);
        expect(() => parseEmailAddress('Pavol Hejn칳')).toThrowError(/Invalid email address/);
        expect(() => parseEmailAddress('Pavol Hejn칳 <>')).toThrowError(/Invalid email address/);
        expect(() => parseEmailAddress('Pavol Hejn칳 <@webgpt.cz>')).toThrowError(/Invalid email address/);
        expect(() => parseEmailAddress('Pavol Hejn칳 <webgpt.cz>')).toThrowError(/Invalid email address/);
        expect(() => parseEmailAddress('Pavol Hejn칳 <pavol@>')).toThrowError(/Invalid email address/);
        expect(() => parseEmailAddress('Pavol Hejn칳 <a@b>')).toThrowError(/Invalid email address/);
    });
});

/**
 * TODO: [游냚] This test fails because of aliased imports `import type { string_emails } from '@promptbook-local/types';`, fix it
 */
