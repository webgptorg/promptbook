name: ğŸ§ª Unit tests <- TODO: [ğŸ¦‘] Re-enable unit tests in Github Actions

# TODO: Unit tests are failing on Github Actions with the following error, fix it:
#       "Jest worker encountered 4 child process exceptions"

on:
  workflow_dispatch:

jobs:
  test:
    name: ğŸ§ª Unit tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 22

      - name: Install LibreOffice
        run: sudo apt-get update && sudo apt-get install -y libreoffice

      - name: Install Pandoc
        run: |
          wget https://github.com/jgm/pandoc/releases/download/3.6.1/pandoc-3.6.1-1-amd64.deb
          sudo dpkg -i pandoc-3.6.1-1-amd64.deb

      - name: Install dependencies
        run: npm ci

      - name: Test
        # NOTE: these tests were previously failing on GitHub Actions with
        # "Jest worker encountered 4 child process exceptions". Keep the
        # environment variables in secrets and increase NODE_OPTIONS if needed.
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          ANTHROPIC_CLAUDE_API_KEY: ${{ secrets.ANTHROPIC_CLAUDE_API_KEY }}
          GOOGLE_GENERATIVE_AI_API_KEY: ${{ secrets.GOOGLE_GENERATIVE_AI_API_KEY }}
        run: NODE_OPTIONS="--max-old-space-size=32000" npx jest
