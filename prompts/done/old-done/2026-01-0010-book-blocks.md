[x]

[✨♧] Books can contain Markdown code blocks.

**When you have code blocks in the book, for example:**

```book
AI Agents creator

PERSONA You can create AI agents.
USER MESSAGE Create agent which writes poems.
AGENT MESSAGE
\`\`\`book
Poem Writer

PERSONA You are a poet.
\`\`\`
Do it!
```

-   The nested `Poem Writer` is a code block of type `book` inside the main book `AI Agents creator`.
-   The nested code block isn't interpreted as commitments, it should be interpreted as raw text.
-   The persona or other commitment in the nested code block isn't the commitment of the main agent. It should be behaved as raw text.
-   This should work for any type of code block, not only for `book` code blocks. But especially for `book` code blocks because they can contain commitments and users can be confused.
-   This must work for `parseAgentSource` and `createAgentModelRequirements` functions and also the <BookEditor /> component.
-   These code blocks in the book editor should be highlighted very distinctly. They are distinct syntax tokens different from the commitments or the parameter or the agent name. This is the distinct syntax element placed in the book.
-   It should work for example with the `Agents Server` application `/apps/agents-server`
-   Keep in mind the DRY _(don't repeat yourself)_ principle.
-   Add the changes into the `/changelog/_current-preversion.md`

**Context:**

-   **Commitments** are basic syntax elements that add specific functionalities to AI agents
    -   They are used in `agentSource`, there are commitments like `PERSONA`, `RULE`, `KNOWLEDGE`, `USE BROWSER`, `USE SEARCH ENGINE`, `META IMAGE`, etc.
    -   Commitments are in the folder `/src/commitments`
    -   Each commitment starts with a keyword, e.g., `KNOWLEDGE`, `USE BROWSER`, etc. on a begining of the line and end by new co
    -   Agent source with commitments is parsed by two functions:
        -   `parseAgentSource` which is a lightweight parser for agent source, it parses basic information and its purpose is to be quick and synchronous. The commitments there are hardcoded.
        -   `createAgentModelRequirements` which is an asynchronous function that creates model requirements it applies each commitment one by one and works asynchronously.

---

[x]

[✨♧] Code blocks in the book should be assigned to the place where they are.

**For example:**

```book
AI Agent

FROM VOID
NOTE This is a note


\`\`\`
Test nested text in the note
\`\`\`


NOTE And another note
RULE Write poems.

\`\`\`
Roses are red,
Violets are blue,
Sugar is sweet,
And so are you.
\`\`\`


```

**Should be interpreted as:**

-   The first code block `Test nested text in the note` is part of the first `NOTE` commitment.
-   The second code block is part of the second `NOTE` commitment.
-   The third code block with the poem is part of the `RULE` commitment.
-   **The code blocks are part of the commitment where they are placed.**
-   This must work for `parseAgentSource` and `createAgentModelRequirements`
-   Keep in mind the DRY _(don't repeat yourself)_ principle.
-   Add the changes into the `/changelog/_current-preversion.md`

**Context:**

-   **Commitments** are basic syntax elements that add specific functionalities to AI agents
    -   They are used in `agentSource`, there are commitments like `PERSONA`, `RULE`, `KNOWLEDGE`, `USE BROWSER`, `USE SEARCH ENGINE`, `META IMAGE`, etc.
    -   Commitments are in the folder `/src/commitments`
    -   Each commitment starts with a keyword, e.g., `KNOWLEDGE`, `USE BROWSER`, etc. on a begining of the line and end by new co
    -   Agent source with commitments is parsed by two functions:
        -   `parseAgentSource` which is a lightweight parser for agent source, it parses basic information and its purpose is to be quick and synchronous. The commitments there are hardcoded.
        -   `createAgentModelRequirements` which is an asynchronous function that creates model requirements it applies each commitment one by one and works asynchronously.

